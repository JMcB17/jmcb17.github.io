<!DOCTYPE html>

<html>
    <head>
        <meta charset="utf-8">
        <title>The 100-dimensional political model</title>

        <script type="text/javascript">
            // Copyright (c) JMcB 2022
            // License: GNU GPLv3
            // https://www.gnu.org/licenses/gpl-3.0.en.html

            const axes = [
                ["economic", "equality", "markets", 75],
                ["cultural", "progress", "tradition", 98],
            ];
            const axesCount = axes.length;

            function getValues() {
                // get the value of each slider and return them as an array
                let values = Array(axesCount);
                for (let i = 0; i < axesCount; i++) {
                    let slider = document.getElementById("slider" + i);
                    values[i] = slider.value;
                }
                return values;
            }

            function setValues(valuesArray) {
                // set the value of each slider from the array
                for (let i = 0; i < axesCount; i++) {
                    let slider = document.getElementById("slider" + i);
                    slider.value = valuesArray[i];
                }
            }

            // encoding could potentially be more efficient?
            // with csv system, digits per axis ranges from 2 to 5
            // if I represented each axis with a padded number from 0 to 200,
            // digits per axis would be constant 3

            function encodeValues(valuesArray) {
                // convert array of values to base64
                valuesString = valuesArray.join(",");
                valuesB64 = btoa(valuesString);
                return valuesB64;
            }

            function decodeValues(valuesB64) {
                // convert base64 to array of values
                valuesString = atob(valuesB64);
                valuesArray = valuesString.split(",");
                return valuesArray;
            }

            function updateFragment() {
                // encode the sum slider value and edit the url hash to match, for sharing
                valuesArray = getValues();
                valuesB64 = encodeValues(valuesArray);
                window.location.hash = valuesB64;
            }

            function updateFromFragment() {
                // get the url hash and set sliders to match
                // todo: error handling?
                valuesB64 = window.location.hash.substring(1);
                valuesArray = decodeValues(valuesB64);
                setValues(valuesArray);
            }

            function assignSlidersOnchange() {
                // set the onchange event to updateFragment for each slider
                for (let i = 0; i < axesCount; i++) {
                    let slider = document.getElementById("slider" + i);
                    slider.onchange = updateFragment;
                }
            }

            function titleCase(string) {
                return string[0].toUpperCase() + string.substring(1)
            }

            function spawnAxis(axisNumber, axisArray, slidersDiv) {
                // spawn a single slider and its labels

                // axis name label for div
                let divId = "div" + axisNumber;
                let newLabel = document.createElement("label");
                newLabel.setAttribute("for", divId);
                let axisName = axisArray[0];
                newLabel.innerText = titleCase(axisName);
                slidersDiv.appendChild(newLabel);

                // div for axis
                let newDiv = document.createElement("div");
                newDiv.id = divId;
                slidersDiv.appendChild(newDiv);

                // left label within div
                sliderId = "slider" + axisNumber;
                let newLabelLeft = document.createElement("label");
                newLabelLeft.setAttribute("for", sliderId);
                newLabelLeft.innerText = axisArray[1];
                newDiv.appendChild(newLabelLeft);

                // input element within div
                let newSlider = document.createElement("input");
                newSlider.type = "range";
                newSlider.min = -100;
                newSlider.max = 100;
                newSlider.step = 1;
                newSlider.value = 0;
                newSlider.id = sliderId;
                newDiv.appendChild(newSlider);

                // right label within div
                let newLabelRight = document.createElement("label");
                newLabelRight.setAttribute("for", sliderId);
                newLabelRight.innerText = axisArray[2];
                newDiv.appendChild(newLabelRight);
            }

            function spawnAxes(slidersDiv) {
                // spawn every slider
                for (let i = 0; i < axesCount; i++) {
                    spawnAxis(i, axes[i], slidersDiv)
                }

                assignSlidersOnchange();
            }

            function ready() {
                let slidersDiv = document.getElementById("sliders");
                spawnAxes(slidersDiv);
                updateFromFragment();
            }

            document.addEventListener("DOMContentLoaded", ready);
        </script>
    </head>
    <body>
        <div align="center">
            <a href="https://youtu.be/UuopBeaUN24">https://youtu.be/UuopBeaUN24</a>
        </div>
        <br>
        <div id="sliders" align="center">
    </body>
</html>